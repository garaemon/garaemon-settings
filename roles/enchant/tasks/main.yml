---
- name: Get ghq root directory
  command: ghq root
  register: enchant_ghq_root
  changed_when: false
  failed_when: false

- name: Set ghq root path
  set_fact:
    enchant_ghq_root_path: "{{ enchant_ghq_root.stdout if enchant_ghq_root.rc == 0 else ansible_env.HOME + '/ghq' }}"

- name: "Install enchant on Debian/Ubuntu"
  apt:
    name: enchant-2
    state: present
  become: true
  when: ansible_os_family == "Debian"

- name: "Install enchant on macOS"
  homebrew:
    name: enchant
    state: present
  when: ansible_os_family == "Darwin"

- name: "Create .config/enchant directory"
  file:
    path: "{{ ansible_env.HOME }}/.config/enchant"
    state: directory
    mode: '0755'

- name: "Create symlink for en_US.dic"
  file:
    src: "{{ enchant_ghq_root_path }}/github.com/garaemon/garaemon-settings/roles/enchant/files/en_US.dic"
    dest: "{{ ansible_env.HOME }}/.config/enchant/en_US.dic"
    state: link
