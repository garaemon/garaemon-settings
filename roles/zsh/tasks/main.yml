- name: Get ghq root directory
  command: ghq root
  register: zsh_ghq_root
  changed_when: false
  failed_when: false

- name: Set ghq root path
  set_fact:
    zsh_ghq_root_path: "{{ zsh_ghq_root.stdout if zsh_ghq_root.rc == 0 else ansible_env.HOME + '/ghq' }}"

- name: Check if zshrc exists
  stat:
    path: ~/.zshrc
  register: zsh_zshrc_stat

- name: Check file differences for zshrc
  command: diff ~/.zshrc "{{ zsh_ghq_root_path }}/github.com/garaemon/garaemon-settings/roles/zsh/files/zshrc"
  register: zsh_zshrc_diff
  failed_when: false
  changed_when: false
  when: zsh_zshrc_stat.stat.exists and not zsh_zshrc_stat.stat.islnk

- name: Remove existing zshrc if identical to target
  file:
    path: ~/.zshrc
    state: absent
  when:
    - zsh_zshrc_stat.stat.exists
    - not zsh_zshrc_stat.stat.islnk
    - zsh_zshrc_diff.rc == 0

- name: Check if zlogin exists
  stat:
    path: ~/.zlogin
  register: zsh_zlogin_stat

- name: Check file differences for zlogin
  command: diff ~/.zlogin "{{ zsh_ghq_root_path }}/github.com/garaemon/garaemon-settings/roles/zsh/files/zlogin"
  register: zsh_zlogin_diff
  failed_when: false
  changed_when: false
  when: zsh_zlogin_stat.stat.exists and not zsh_zlogin_stat.stat.islnk

- name: Remove existing zlogin if identical to target
  file:
    path: ~/.zlogin
    state: absent
  when:
    - zsh_zlogin_stat.stat.exists
    - not zsh_zlogin_stat.stat.islnk
    - zsh_zlogin_diff.rc == 0

- name: Check if zlogout exists
  stat:
    path: ~/.zlogout
  register: zsh_zlogout_stat

- name: Check file differences for zlogout
  command: diff ~/.zlogout "{{ zsh_ghq_root_path }}/github.com/garaemon/garaemon-settings/roles/zsh/files/zlogout"
  register: zsh_zlogout_diff
  failed_when: false
  changed_when: false
  when: zsh_zlogout_stat.stat.exists and not zsh_zlogout_stat.stat.islnk

- name: Remove existing zlogout if identical to target
  file:
    path: ~/.zlogout
    state: absent
  when:
    - zsh_zlogout_stat.stat.exists
    - not zsh_zlogout_stat.stat.islnk
    - zsh_zlogout_diff.rc == 0

- name: Check if zprofile exists
  stat:
    path: ~/.zprofile
  register: zsh_zprofile_stat

- name: Check file differences for zprofile
  command: diff ~/.zprofile "{{ zsh_ghq_root_path }}/github.com/garaemon/garaemon-settings/roles/zsh/files/zprofile"
  register: zsh_zprofile_diff
  failed_when: false
  changed_when: false
  when: zsh_zprofile_stat.stat.exists and not zsh_zprofile_stat.stat.islnk

- name: Remove existing zprofile if identical to target
  file:
    path: ~/.zprofile
    state: absent
  when:
    - zsh_zprofile_stat.stat.exists
    - not zsh_zprofile_stat.stat.islnk
    - zsh_zprofile_diff.rc == 0

- name: Check if zshenv exists
  stat:
    path: ~/.zshenv
  register: zsh_zshenv_stat

- name: Check file differences for zshenv
  command: diff ~/.zshenv "{{ zsh_ghq_root_path }}/github.com/garaemon/garaemon-settings/roles/zsh/files/zshenv"
  register: zsh_zshenv_diff
  failed_when: false
  changed_when: false
  when: zsh_zshenv_stat.stat.exists and not zsh_zshenv_stat.stat.islnk

- name: Remove existing zshenv if identical to target
  file:
    path: ~/.zshenv
    state: absent
  when:
    - zsh_zshenv_stat.stat.exists
    - not zsh_zshenv_stat.stat.islnk
    - zsh_zshenv_diff.rc == 0

- name: Check if zshrc.zplug exists
  stat:
    path: ~/.zshrc.zplug
  register: zsh_zshrc_zplug_stat

- name: Check file differences for zshrc.zplug
  command: diff ~/.zshrc.zplug "{{ zsh_ghq_root_path }}/github.com/garaemon/garaemon-settings/roles/zsh/files/zshrc.zplug"
  register: zsh_zshrc_zplug_diff
  failed_when: false
  changed_when: false
  when: zsh_zshrc_zplug_stat.stat.exists and not zsh_zshrc_zplug_stat.stat.islnk

- name: Remove existing zshrc.zplug if identical to target
  file:
    path: ~/.zshrc.zplug
    state: absent
  when:
    - zsh_zshrc_zplug_stat.stat.exists
    - not zsh_zshrc_zplug_stat.stat.islnk
    - zsh_zshrc_zplug_diff.rc == 0

- name: Create symlink for zshrc
  file:
    src: "{{ zsh_ghq_root_path }}/github.com/garaemon/garaemon-settings/roles/zsh/files/zshrc"
    dest: ~/.zshrc
    state: link

- name: Create symlink for zlogin
  file:
    src: "{{ zsh_ghq_root_path }}/github.com/garaemon/garaemon-settings/roles/zsh/files/zlogin"
    dest: ~/.zlogin
    state: link

- name: Create symlink for zlogout
  file:
    src: "{{ zsh_ghq_root_path }}/github.com/garaemon/garaemon-settings/roles/zsh/files/zlogout"
    dest: ~/.zlogout
    state: link

- name: Create symlink for zprofile
  file:
    src: "{{ zsh_ghq_root_path }}/github.com/garaemon/garaemon-settings/roles/zsh/files/zprofile"
    dest: ~/.zprofile
    state: link

- name: Create symlink for zshenv
  file:
    src: "{{ zsh_ghq_root_path }}/github.com/garaemon/garaemon-settings/roles/zsh/files/zshenv"
    dest: ~/.zshenv
    state: link

- name: Create symlink for zshrc.zplug
  file:
    src: "{{ zsh_ghq_root_path }}/github.com/garaemon/garaemon-settings/roles/zsh/files/zshrc.zplug"
    dest: ~/.zshrc.zplug
    state: link
